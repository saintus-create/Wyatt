---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import type { GetStaticPaths, Page } from "astro";
import type { CollectionEntry } from "astro:content";

export const getStaticPaths = (async ({ paginate }) => {
  const allPosts = await getCollection("blog");
  const sortedPosts = allPosts.sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

  return paginate(sortedPosts, { pageSize: 7 });
}) satisfies GetStaticPaths;

interface Props {
  page: Page<CollectionEntry<"blog">>;
}

const { page } = Astro.props;

// Format date helper
function formatDate(date: Date) {
  return new Date(date).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<BaseLayout
  title="Blog"
  description="Articles, tutorials, and thoughts on web development with Astro, React, and modern web technologies"
>
  <div class="container max-w-4xl mx-auto py-20">
    <div class="mb-20">
      <h1 class="text-7xl font-bold tracking-tight mb-8">Blog</h1>
      <p class="text-xl text-muted-foreground">
        Where ancient monsters navigate modern bureaucracy, mythical creatures struggle with technology, and the supernatural discovers that HOA violations are scarier than dragonslayers.
      </p>
    </div>

    <div class="space-y-8">
      {
        page.data.map((post, index) => (
          <article class="group">
            <a href={`/blog/${post.id}`} class="flex items-center justify-between gap-8 -mx-6 px-6 py-4 rounded-lg transition-colors hover:bg-accent/50">
              <h2 class="text-4xl font-bold tracking-tight group-hover:text-primary transition-colors flex-1">
                {post.data.title}
              </h2>
              <time datetime={post.data.pubDate.toISOString()} class="text-sm text-muted-foreground whitespace-nowrap">
                {formatDate(post.data.pubDate)}
              </time>
            </a>
            {index < page.data.length - 1 && (
              <div class="mt-8 border-b border-border"></div>
            )}
          </article>
        ))
      }
    </div>

    {(page.url.prev || page.url.next) && (
      <nav class="mt-16 flex items-center justify-between gap-8 pt-8 border-t">
        {page.url.prev ? (
          <a
            href={page.url.prev}
            class="group flex items-center gap-2 text-sm font-medium hover:text-primary transition-colors"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m15 18-6-6 6-6"></path>
            </svg>
            <span>Previous</span>
          </a>
        ) : (
          <div></div>
        )}

        <div class="flex items-center gap-2 text-sm text-muted-foreground">
          <span>Page {page.currentPage} of {page.lastPage}</span>
        </div>

        {page.url.next ? (
          <a
            href={page.url.next}
            class="group flex items-center gap-2 text-sm font-medium hover:text-primary transition-colors"
          >
            <span>Next</span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="m9 18 6-6-6-6"></path>
            </svg>
          </a>
        ) : (
          <div></div>
        )}
      </nav>
    )}
  </div>
</BaseLayout>
