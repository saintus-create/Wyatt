---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCollection } from "astro:content";

// Get all blog posts
const allPosts = await getCollection("blog");

// Extract all unique tags and count posts per tag
const uniqueTags = [...new Set(allPosts.map((post) => post.data.tags).flat())];

// Create array with tag counts
const tagsWithCounts = uniqueTags.map((tag) => ({
  tag,
  count: allPosts.filter((post) => post.data.tags.includes(tag)).length,
}));

// Sort tags alphabetically
tagsWithCounts.sort((a, b) => a.tag.localeCompare(b.tag));
---

<BaseLayout
  title="Tags"
  description="Browse all blog post tags"
>
  <div class="container max-w-4xl mx-auto py-16">
    <div class="mb-16">
      <h1 class="text-6xl font-bold tracking-tight mb-6">Tags</h1>
      <p class="text-xl text-muted-foreground">
        Browse articles by topic.
      </p>
    </div>

    <div class="flex flex-wrap gap-4">
      {
        tagsWithCounts.map(({ tag, count }) => (
          <a
            href={`/tags/${tag}`}
            class="group inline-flex items-center gap-2 px-6 py-3 rounded-full border border-border bg-card hover:bg-accent hover:border-primary transition-all"
          >
            <span class="text-lg font-medium group-hover:text-primary transition-colors">
              {tag}
            </span>
            <span class="text-sm text-muted-foreground">({count})</span>
          </a>
        ))
      }
    </div>
  </div>
</BaseLayout>
